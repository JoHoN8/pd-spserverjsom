!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("pd-sputil")):"function"==typeof define&&define.amd?define(["pd-sputil"],t):"object"==typeof exports?exports.pdspserverjsom=t(require("pd-sputil")):e.pdspserverjsom=t(e.pdsputil)}(this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return Object(f.waitForScriptsReady)("sp.js").then(function(){return h(e)})}function a(e){return Object(f.waitForScriptsReady)("SP.js").then(function(){var t,n,r,o=e.url?new SP.ClientContext(e.url):new SP.ClientContext.get_current,a=new SP.CamlQuery;return r=e.listGUID?o.get_web().get_lists().getById(e.listGUID):o.get_web().get_lists().getById(e.listTitle),e.position&&(t=new SP.ListItemCollectionPosition,t.set_pagingInfo(e.position),a.set_listItemCollectionPosition(t)),e.folderRelativeUrl&&a.set_folderServerRelativeUrl(e.folderRelativeUrl),a.set_viewXml(e.query),n=r.getItems(a),e.columnsToInclude?o.load(n,"Include("+e.columnsToInclude.join(",")+")"):o.load(n),c({context:o,listItems:n})})}function i(e,t){var n,r,o,a,i,l=Object(f.getDataType)(t),s=/^i:0#\.f\|membership\|/,u=[];if("object"===l&&(n=[t]),"array"===l&&(n=t),!n)throw new Error("an object or array must be the parameter to jsomEnsureUser");return r=e?new SP.ClientContext(e):new SP.ClientContext.get_current,a=r.get_web(),n.forEach(function(e,t){o=e.AccountName||e.WorkEmail,s.test(o)||(e.AccountName="i:0#.f|membership|"+o.toLowerCase(),o=e.AccountName),i=a.ensureUser(o),u[t]=i,r.load(u[t])}),c({context:r}).then(function(){var e;return n.forEach(function(t,n){e=u[n],t.id=e.get_id(),t.WorkEmail||(t.WorkEmail=e.get_email()),t.PreferredName||(t.PreferredName=e.get_title())}),"[object Object]"===l?n[0]:n})}function l(e){return Object(f.waitForScriptsReady)("SP.js").then(function(){var t,n=e.url?new SP.ClientContext(e.url):new SP.ClientContext.get_current,r=e.allResults||[],o=e.maxPerTrip||100,a=e.arrayOfIds.length,i=e.numberToStartAt||0,s=[];for(t=e.listGUID?n.get_web().get_lists().getById(e.listGUID):n.get_web().get_lists().getByTitle(e.listTitle);i<a;){var u=t.getItemById(e.arrayOfIds[i]);if(e.columnsToInclude?n.load(u,e.columnsToInclude):n.load(u),s.push(u),s.length===o){i++;break}i++}return c({context:n,listItems:s}).then(function(t){var n=y(t.listItems);return e.allResults=r.concat(n),i<a?(e.numberToStartAt=i,l(e)):e.allResults})})}function s(e){return Object(f.waitForScriptsReady)("SP.js").then(function(){for(var t=e.url?new SP.ClientContext(e.url):new SP.ClientContext.get_current,n=t.get_web(),r=e.fileRefs.length,o=0,a=[];o<r;){var i=n.getFileByServerRelativeUrl(e.fileRefs[o]);e.columnsToInclude?t.load(i,e.columnsToInclude):t.load(i),a.push(i),o++}return c({context:t,files:a}).then(function(e){return e})})}function u(e,t){return Object(f.waitForScriptsReady)("sp.js").then(function(){return SP.Taxonomy?Promise.resolve():Object(f.loadSPScript)("sp.taxonomy.js")}).then(function(){var n=new SP.ClientContext.get_current,r=SP.Taxonomy.TaxonomySession.getTaxonomySession(n),o=r.get_termStores().getById(e),a=o.getTermSet(t),i=a.getAllTerms();return n.load(i,"Include(CustomProperties, Id,IsAvailableForTagging, LocalCustomProperties, Name, PathOfTerm)"),c({context:n,terms:i})})}function c(e){return new Promise(function(t,n){e.context.executeQueryAsync(function(){t(e)},function(){n(arguments)})})}function m(e){var t=null;if(e.configured)t=e;else{var n={totalPerTrip:50,numberToStartAt:0,totalItems:e.columnInfo.length,allItems:[],configured:!0};t=Object.assign({},n,e)}var r=new I,o=t.numberToStartAt;for(o;o<t.totalItems;o++){r.createItem(t.columnInfo[o]);if(r.totalRequests()===t.totalPerTrip||o===t.totalItems){o++;break}}return t.numberToStartAt=o,r.sendToSever(t.url,t.listGUID).then(function(e){var n=e.listItems;return t.allItems=t.allItems.concat(n),t.numberToStartAt<t.totalItems?m(t):t.allItems})}function d(e){var t=null;if(e.configured)t=e;else{var n={totalPerTrip:50,numberToStartAt:0,totalItems:e.updateInfo.length,allItems:[],configured:!0};t=Object.assign({},n,e)}var r=new I,o=t.numberToStartAt;for(o;o<t.totalItems;o++){var a=t.updateInfo[o];r.updateItem(a.itemId,a.columnInfo);if(r.totalRequests()===t.totalPerTrip||o===t.totalItems){o++;break}}return t.numberToStartAt=o,r.sendToSever(t.url,t.listGUID).then(function(e){var n=e.listItems;return t.allItems=t.allItems.concat(n),t.numberToStartAt<t.totalItems?d(t):t.allItems})}Object.defineProperty(t,"__esModule",{value:!0}),t.jsomGetDataFromSearch=o,t.jsomListItemRequest=a,t.jsomEnsureUser=i,t.jsomGetItemsById=l,t.jsomGetFilesByRelativeUrl=s,t.jsomTaxonomyRequest=u,t.jsomSendDataToServer=c,n.d(t,"jsomCUD",function(){return I}),t.jsomCreateItemsMetered=m,t.jsomUpdateItemsMetered=d;var f=n(1),p=(n.n(f),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),y=function(e){var t,n=[];if(t=e.context?e.listItems:e,t.getEnumerator){for(var r=t.getEnumerator();r.moveNext();)n.push(r.get_current().get_fieldValues());return n}return t.forEach(function(e){n.push(e.get_fieldValues())}),n},h=function e(t){var n=null,r=t.allResults||[],o=Microsoft.SharePoint.Client;return n=o&&o.Search?Promise.resolve():Object(f.loadSPScript)("SP.Search.js"),n.then(function(){var e=t.url?new SP.ClientContext(t.url):new SP.ClientContext("/search"),n=new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(e);if(t.startRow||(t.startRow=0),t.rowLimit||(t.rowLimit=250),n.set_queryText(t.query),n.set_sourceId(t.sourceId),n.set_trimDuplicates(t.trimDuplicates||!1),n.set_startRow(t.startRow),n.set_rowLimit(t.rowLimit),t.properties){var r=n.get_selectProperties();t.properties.forEach(function(e){r.add(e)})}return c({context:e,results:new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(e).executeQuery(n)})}).then(function(n){var o=n.results.get_value(),a=o.ResultTables[0],i=a.ResultRows;return 0===i.length?t.allResults=[]:t.allResults=r.concat(i),a.TotalRows>t.startRow+a.RowCount?(t.startRow=t.startRow+a.RowCount,e(t)):t.allResults})};!function(){try{Object.assign,Promise}catch(e){throw new Error("The pd-spserverjsom library requires a polyfill for Object.assign and Promise. Please add both to continue.")}}();var I=function(){function e(){r(this,e),this.itemsToSend=[],this.userRequests=[]}return p(e,[{key:"_getContext",value:function(e){return this.context=e?new this.sp.ClientContext(e):new this.sp.ClientContext.get_current,this}},{key:"_getList",value:function(e){var t=Object(f.validGuid)(e);return this.list=t?this.context.get_web().get_lists().getById(e):this.context.get_web().get_lists().getByTitle(e),this}},{key:"_dataTranmitter",value:function(){return c({context:this.context,listItems:this.itemsToSend})}},{key:"_addColumnData",value:function(e,t){var n=this;return t.forEach(function(t){if("taxBlank"===t.dataType){var r=n.list.get_fields().getByInternalNameOrTitle(t.columnName);n.context.castTo(r,n.sp.Taxonomy.TaxonomyField).validateSetValue(e,null)}else if("taxSingle"===t.dataType){var o=n.list.get_fields().getByInternalNameOrTitle(t.columnName),a=n.context.castTo(o,n.sp.Taxonomy.TaxonomyField),i=new n.sp.Taxonomy.TaxonomyFieldValue;i.set_label(t.termLabel),i.set_termGuid(t.termGuid),i.set_wssId(-1),a.setFieldValueByValue(e,i)}else if("taxMulti"===t.dataType){var l=n.list.get_fields().getByInternalNameOrTitle(t.columnName),s=n.context.castTo(l,n.sp.Taxonomy.TaxonomyField),u=t.multiTerms.map(function(e){return"-1;# "+e.termLabel+"|"+e.termGuid}),c=n.sp.Taxonomy.TaxonomyFieldValueCollection(u.join(";#"),s);s.setFieldValueByValueCollection(e,c)}else if("choiceMulti"===t.dataType)e.set_item(t.columnName,t.choices);else if("lookupSingle"===t.dataType){var m=new n.sp.FieldLookupValue;m.set_lookupId(t.itemId),e.set_item(t.columnName,m)}else if("lookupMulti"===t.dataType){var d=t.idArray.map(function(e){return n.sp.FieldUserValue.fromUser(e)});e.set_item(t.columnName,d)}else if("ppSingle"===t.dataType){var f=n.sp.FieldUserValue.fromUser(t.account);e.set_item(t.columnName,f)}else if("ppMulti"===t.dataType){var p=t.accountArray.map(function(e){return(new n.sp.FieldLookupValue).set_lookupId(e)});e.set_item(t.columnName,p)}else if("hyperlink"===t.dataType){var y=new n.sp.FieldUrlValue;y.set_url(t.url),y.set_description(t.description),e.set_item(t.columnName,y)}else"simple"===t.dataType&&e.set_item(t.columnName,t.columnValue)},this),this}},{key:"_loadItem",value:function(e){var t=this.itemsToSend.length;return e.update(),this.itemsToSend[t]=e,this.context.load(this.itemsToSend[t]),this}},{key:"_createListItems",value:function(){var e=this;return this.userRequests.forEach(function(t){var n=null;"create"===t.action?(n=e.list.addItem(new e.sp.ListItemCreationInformation),e._addColumnData(n,t.columnData)._loadItem(n)):"update"===t.action?(n=e.list.getItemById(t.itemId),e._addColumnData(n,t.columnData)._loadItem(n)):"recycle"===t.action?(n=e.list.getItemById(t.itemId),n.recycle()):"delete"===t.action&&(n=e.list.getItemById(t.itemId),n.deleteObject())},this),this}},{key:"_determineDataType",value:function(e){null===e.termGuid?e.dataType="taxBlank":e.termGuid?e.dataType="taxSingle":e.multiTerms?e.dataType="taxMulti":e.choices?e.dataType="choiceMulti":e.itemId?e.dataType="lookupSingle":e.idArray?e.dataType="lookupMulti":e.account?e.dataType="ppSingle":e.accountArray?e.dataType="ppMulti":e.url?e.dataType="hyperlink":e.dataType="simple"}},{key:"_addDataType",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=Object.assign({},e);t._determineDataType(r),n.push(r)}),n}},{key:"_addItem",value:function(e,t,n){var r={};if(!e)throw new Error("action must be provided to add an object to addItem function");if(r.action=e.toLowerCase(),"create"!==e&&!n)throw new Error("a item id must be provided to update, delete or recycle an item");r.itemId=n,"create"!==e&&"update"!==e||(r.columnData=this._addDataType(t)),this.userRequests.push(r)}},{key:"createItem",value:function(e){this._addItem("create",e)}},{key:"updateItem",value:function(e,t){this._addItem("update",t,e)}},{key:"recycleItem",value:function(e){var t=this,n=Object(f.getDataType)(e);if("number"===n)this._addItem("recycle",null,e);else{if("array"!==n)throw new Error("invalid datatype passed to recycle item function");e.forEach(function(e){t._addItem("recycle",null,e)},this)}}},{key:"deleteItem",value:function(e){var t=this,n=Object(f.getDataType)(e);if("number"===n)this._addItem("delete",null,e);else{if("array"!==n)throw new Error("invalid datatype passed to delete item function");e.forEach(function(e){t._addItem("delete",null,e)},this)}}},{key:"totalRequests",value:function(){return this.userRequests.length}},{key:"sendToSever",value:function(e,t){var n=this;return Object(f.waitForScriptsReady)("sp.js").then(function(){return n.sp=SP,n._getContext(e)._getList(t)._createListItems(),n._dataTranmitter()})}}]),e}()},function(t,n){t.exports=e}])});